<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weligama DS Office Feedback</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- env.js is generated at deploy time (CI) and exposes window.SUPABASE_URL and window.SUPABASE_KEY -->
    <script src="/env.js"></script>
    <style>
        * { box-sizing: border-box; }
        
        body, html {
            height: 100%; margin: 0; padding: 0; overflow: hidden;
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: #f0f2f5; display: flex; flex-direction: column;
        }

        header {
            width: 100%; background-color: #2c3e50; color: white;
            padding: 30px 0; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .office-name { font-size: 4rem; font-weight: bold; margin: 0; cursor: pointer; }
        a { text-decoration: none; color: inherit; }

        #main-wrapper {
            flex: 1; display: flex; justify-content: center; align-items: center;
            width: 100%; padding: 20px;
        }

        .step {
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; width: 100%; animation: fadeIn 0.4s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }

        .question {
            font-size: 4.5rem; font-weight: 800; margin-bottom: 2.5rem;
            color: #1a1a1a; text-align: center; max-width: 90%; line-height: 1.3;
        }

        .btn-container { display: flex; justify-content: center; gap: 40px; flex-wrap: wrap; width: 100%; }

        button {
            padding: 30px; font-size: 2.5rem; font-weight: bold; cursor: pointer;
            border: none; border-radius: 25px; box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }

        button:active { transform: scale(0.95); }
        .btn-yes { background-color: #00c853; color: white; min-width: 350px; }
        .btn-no { background-color: #ff3d00; color: white; min-width: 350px; }
        
        .branch-grid {
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 15px; width: 95%; max-width: 1350px;
        }

        /* Standard Branch Style */
        .btn-branch { 
            background-color: #ffffff; color: #2980b9; 
            border: 4px solid #2980b9; font-size: 1.8rem; padding: 20px;
        }

        /* Senior Officers Style (Different Color) */
        .btn-officer {
            background-color: #34495e; color: #ffffff;
            border: 4px solid #2c3e50; font-size: 1.8rem; padding: 20px;
        }

        .btn-branch:active, .btn-officer:active { background-color: #1a1a1a; color: white; }

        input[type="text"] {
            font-size: 4.5rem; padding: 25px; width: 80%; max-width: 800px;
            border: 6px solid #2c3e50; border-radius: 25px; text-align: center;
            margin-bottom: 40px; outline: none;
        }

        .btn-submit { background-color: #2c3e50; color: white; width: 500px; font-size: 3.5rem; }
        .btn-back { background-color: #95a5a6; color: white; font-size: 1.5rem; padding: 15px 30px; margin-top: 25px; border-radius: 15px; }

        .hidden { display: none; }

        @media (max-height: 900px) {
            .office-name { font-size: 2.5rem; }
            .question { font-size: 2.8rem; margin-bottom: 1.5rem; }
            .btn-branch, .btn-officer { font-size: 1.5rem; padding: 15px; }
            button { font-size: 2rem; }
        }
    </style>
</head>
<body>

<header>
    <a href="dashboard.html"><div class="office-name">ප්‍රාදේශීය ලේකම් කාර්යාලය - වැලිගම</div></a>
</header>

<div id="main-wrapper">
    <div id="step-1" class="step">
        <div class="question">ඔබ අප කාර්යාලයෙන් ලද සේවාව ගැන තෘප්තිමත්ද?</div>
        <div class="btn-container">
            <button class="btn-yes" onclick="selectSatisfaction('ඔව්')">ඔව්</button>
            <button class="btn-no" onclick="selectSatisfaction('නැත')">නැත</button>
        </div>
    </div>

    <div id="step-2" class="step hidden">
        <div class="question" style="font-size: 3.5rem; margin-bottom: 1.5rem;">ඔබ පැමිණි අංශය / නිලධාරියා</div>
        <div class="branch-grid">
            <button class="btn-officer" onclick="selectBranch('ප්‍රාදේශීය ලේකම්')">ප්‍රාදේශීය ලේකම්</button>
            <button class="btn-officer" onclick="selectBranch('සහකාර ප්‍රාදේශීය ලේකම්')">සහකාර ප්‍රාදේශීය ලේකම්</button>
            <button class="btn-officer" onclick="selectBranch('ගණකාධිකාරී')">ගණකාධිකාරී</button>
            <button class="btn-officer" onclick="selectBranch('සහකාර අධ්‍යක්ෂ')">සහකාර අධ්‍යක්ෂ</button>
            <button class="btn-officer" onclick="selectBranch('පරිපාලන නිලධාරී')">පරිපාලන නිලධාරී</button>
            <button class="btn-officer" onclick="selectBranch('පරිපාලන ග්‍රාම නිලධාරී')">පරිපාලන ග්‍රාම නිලධාරී</button>

            <button class="btn-branch" onclick="selectBranch('ආයතන අංශය')">ආයතන අංශය</button>
            <button class="btn-branch" onclick="selectBranch('ගිණුම් අංශය')">ගිණුම් අංශය</button>
            <button class="btn-branch" onclick="selectBranch('ඉඩම් අංශය')">ඉඩම් අංශය</button>
            <button class="btn-branch" onclick="selectBranch('රෙජිස්ට්‍රාර් අංශය')">රෙජිස්ට්‍රාර් අංශය</button>
            <button class="btn-branch" onclick="selectBranch('සංවර්ධන අංශය')">සංවර්ධන අංශය</button>
            <button class="btn-branch" onclick="selectBranch('ක්ෂේත්‍ර අංශය')">ක්ෂේත්‍ර අංශය</button>
            <button class="btn-branch" onclick="selectBranch('තාක්ෂණ නිලධාරී')">තාක්ෂණ නිලධාරී</button>
            <button class="btn-branch" onclick="selectBranch('සමාජ සේවා අංශය')">සමාජ සේවා අංශය</button>
            <button class="btn-branch" onclick="selectBranch('හැඳුනුම්පත් අංශය')">හැඳුනුම්පත් අංශය</button>
            <button class="btn-branch" onclick="selectBranch('සමෘද්ධි අංශය')">සමෘද්ධි අංශය</button>
            <button class="btn-branch" onclick="selectBranch('විශ්‍රාම වැටුප් අංශය')">විශ්‍රාම වැටුප් අංශය</button>
            <button class="btn-branch" onclick="selectBranch('බලපත්‍ර අංශය')">බලපත්‍ර අංශය</button>
        </div>
        <button class="btn-back" onclick="showStep('step-1')">ආපසු</button>
    </div>

    <div id="step-3" class="step hidden">
        <div class="question">ඔබේ දුරකථන අංකය ඇතුළත් කරන්න</div>
        <input type="text" id="phone-input" placeholder="07XXXXXXXX" inputmode="numeric">
        <button class="btn-submit" id="submit-btn" onclick="finalSubmit()">ඇතුළත් කරන්න</button>
        <button class="btn-back" onclick="showStep('step-2')">ආපසු</button>
    </div>

    <div id="step-final-yes" class="step hidden">
        <div class="question" style="color: #00c853; font-size: 6rem;">ස්තුතියි!</div>
        <div style="font-size: 3rem; color: #555;">ඔබගේ ප්‍රතිචාරය වාර්තා කරගන්නා ලදී.</div>
    </div>

    <div id="step-final-no" class="step hidden">
        <div class="question" style="color: #ff3d00; font-size: 4rem;">ඔබට සිදුවූ අපහසුතාවය ගැන කණගාටුයි.</div>
        <div style="font-size: 3rem; color: #555; text-align: center; padding: 0 20px;">අපි ඉක්මණින් මේ පිළිබඳ සොයා බලන්නෙමු.</div>
    </div>
</div>

<script>
    // Supabase config is injected at deploy/runtime via /env.js (do NOT hardcode keys in repo)
    const SUPABASE_URL = window.SUPABASE_URL || '';
    const SUPABASE_KEY = window.SUPABASE_KEY || '';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let feedbackData = { satisfied: '', branch: '', phone: '' };

    function showStep(stepId) {
        document.querySelectorAll('.step').forEach(div => div.classList.add('hidden'));
        document.getElementById(stepId).classList.remove('hidden');
    }

    function selectSatisfaction(value) {
        feedbackData.satisfied = value;
        showStep('step-2');
    }

    function selectBranch(branchName) {
        feedbackData.branch = branchName;
        if (feedbackData.satisfied === 'නැත') { showStep('step-3'); } 
        else { finalSubmit(); }
    }

    async function finalSubmit() {
        feedbackData.phone = document.getElementById('phone-input').value || 'N/A';
        const btn = document.getElementById('submit-btn');
        if (btn) btn.disabled = true;

        try {
            await supabaseClient.from('office_feedback').insert([feedbackData]);
            showStep(feedbackData.satisfied === 'නැත' ? 'step-final-no' : 'step-final-yes');
        } catch (error) {
            showStep('step-final-yes'); 
        }
        
        setTimeout(() => { location.reload(); }, 5000);
    }
</script>

</body>
</html>